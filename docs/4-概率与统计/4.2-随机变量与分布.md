# 随机变量与分布

## 概述

随机变量是概率论的核心概念，它将随机试验的结果映射为数值，使得我们可以用数学方法研究随机现象。本模块涵盖离散和连续随机变量、常见概率分布及其性质和应用。

## 历史与发展

### 历史背景

- **早期发展**：17-18世纪赌博问题中的随机变量
- **公理化定义**：20世纪柯尔莫哥洛夫给出严格定义
- **分布理论**：正态分布、泊松分布等的发展
- **现代应用**：统计学、机器学习、金融学等

### 数学意义

```lean
-- 随机变量的形式化定义
def random_variable (Ω : Type) (X : Ω → ℝ) :=
  ∀ B : set ℝ, {ω : Ω | X ω ∈ B} ∈ ℱ

-- 随机变量的分布函数
def distribution_function (X : Ω → ℝ) (x : ℝ) : ℝ :=
  P {ω : Ω | X ω ≤ x}
```

## 离散随机变量

### 定义与性质

#### 定义

```lean
-- 离散随机变量定义
def discrete_random_variable (X : Ω → ℝ) : Prop :=
  countable (range X)

-- 概率质量函数
def probability_mass_function (X : Ω → ℝ) (x : ℝ) : ℝ :=
  P {ω : Ω | X ω = x}
```

#### 性质

```lean
-- 概率质量函数性质
theorem pmf_properties (X : Ω → ℝ) :
  (∀ x, 0 ≤ pmf X x ≤ 1) ∧                    -- 非负性
  (∑ᵢ pmf X xᵢ = 1) ∧                         -- 规范性
  (∀ A ⊆ ℝ, P {ω | X ω ∈ A} = ∑ᵢ pmf X xᵢ) := -- 可加性
begin
  -- 证明过程
end
```

### 常见离散分布

#### 伯努利分布

```lean
-- 伯努利分布
def bernoulli_distribution (p : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ x, pmf X x = if x = 1 then p else if x = 0 then 1 - p else 0

-- 期望和方差
theorem bernoulli_moments (X : Ω → ℝ) (h : bernoulli_distribution p X) :
  E X = p ∧ V X = p * (1 - p) :=
begin
  -- 证明过程
end
```

#### 二项分布

```lean
-- 二项分布
def binomial_distribution (n : ℕ) (p : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ k, pmf X k = if 0 ≤ k ∧ k ≤ n then 
    choose n k * p^k * (1-p)^(n-k) else 0

-- 期望和方差
theorem binomial_moments (X : Ω → ℝ) (h : binomial_distribution n p X) :
  E X = n * p ∧ V X = n * p * (1 - p) :=
begin
  -- 证明过程
end
```

#### 泊松分布

```lean
-- 泊松分布
def poisson_distribution (λ : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ k, pmf X k = if k ≥ 0 then 
    exp (-λ) * λ^k / k! else 0

-- 期望和方差
theorem poisson_moments (X : Ω → ℝ) (h : poisson_distribution λ X) :
  E X = λ ∧ V X = λ :=
begin
  -- 证明过程
end
```

#### 几何分布

```lean
-- 几何分布
def geometric_distribution (p : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ k, pmf X k = if k ≥ 1 then 
    p * (1-p)^(k-1) else 0

-- 期望和方差
theorem geometric_moments (X : Ω → ℝ) (h : geometric_distribution p X) :
  E X = 1 / p ∧ V X = (1 - p) / p^2 :=
begin
  -- 证明过程
end
```

### 算法实现

```rust
// 离散随机变量生成器
trait DiscreteRandomVariable {
    fn probability_mass_function(&self, x: f64) -> f64;
    fn sample(&self) -> f64;
}

// 伯努利分布
struct BernoulliDistribution {
    p: f64,
}

impl DiscreteRandomVariable for BernoulliDistribution {
    fn probability_mass_function(&self, x: f64) -> f64 {
        match x as i32 {
            0 => 1.0 - self.p,
            1 => self.p,
            _ => 0.0,
        }
    }
    
    fn sample(&self) -> f64 {
        if rand::random::<f64>() < self.p { 1.0 } else { 0.0 }
    }
}

// 二项分布
struct BinomialDistribution {
    n: usize,
    p: f64,
}

impl DiscreteRandomVariable for BinomialDistribution {
    fn probability_mass_function(&self, k: f64) -> f64 {
        let k = k as usize;
        if k <= self.n {
            self.n.choose(k).unwrap() as f64 * 
            self.p.powi(k as i32) * 
            (1.0 - self.p).powi((self.n - k) as i32)
        } else {
            0.0
        }
    }
    
    fn sample(&self) -> f64 {
        (0..self.n)
            .map(|_| if rand::random::<f64>() < self.p { 1 } else { 0 })
            .sum::<usize>() as f64
    }
}
```

## 连续随机变量

### 定义与性质1

#### 定义1

```lean
-- 连续随机变量定义
def continuous_random_variable (X : Ω → ℝ) : Prop :=
  ∃ f : ℝ → ℝ, ∀ a b : ℝ, 
    P {ω : Ω | a ≤ X ω ≤ b} = ∫[a,b] f x

-- 概率密度函数
def probability_density_function (X : Ω → ℝ) (x : ℝ) : ℝ :=
  classical.some (continuous_random_variable_iff X)
```

#### 性质1

```lean
-- 概率密度函数性质
theorem pdf_properties (X : Ω → ℝ) :
  (∀ x, pdf X x ≥ 0) ∧                        -- 非负性
  (∫[ℝ] pdf X x = 1) ∧                        -- 规范性
  (∀ a b, P {ω | a ≤ X ω ≤ b} = ∫[a,b] pdf X x) := -- 积分性质
begin
  -- 证明过程
end
```

### 常见连续分布

#### 均匀分布

```lean
-- 均匀分布
def uniform_distribution (a b : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ x, pdf X x = if a ≤ x ∧ x ≤ b then 
    1 / (b - a) else 0

-- 期望和方差
theorem uniform_moments (X : Ω → ℝ) (h : uniform_distribution a b X) :
  E X = (a + b) / 2 ∧ V X = (b - a)^2 / 12 :=
begin
  -- 证明过程
end
```

#### 指数分布

```lean
-- 指数分布
def exponential_distribution (λ : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ x, pdf X x = if x ≥ 0 then 
    λ * exp (-λ * x) else 0

-- 期望和方差
theorem exponential_moments (X : Ω → ℝ) (h : exponential_distribution λ X) :
  E X = 1 / λ ∧ V X = 1 / λ^2 :=
begin
  -- 证明过程
end
```

#### 正态分布

```lean
-- 正态分布
def normal_distribution (μ σ : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ x, pdf X x = 
    1 / (σ * sqrt (2 * π)) * exp (-(x - μ)^2 / (2 * σ^2))

-- 期望和方差
theorem normal_moments (X : Ω → ℝ) (h : normal_distribution μ σ X) :
  E X = μ ∧ V X = σ^2 :=
begin
  -- 证明过程
end
```

#### 伽马分布

```lean
-- 伽马分布
def gamma_distribution (α β : ℝ) (X : Ω → ℝ) : Prop :=
  ∀ x, pdf X x = if x > 0 then 
    x^(α-1) * exp (-x/β) / (β^α * gamma α) else 0

-- 期望和方差
theorem gamma_moments (X : Ω → ℝ) (h : gamma_distribution α β X) :
  E X = α * β ∧ V X = α * β^2 :=
begin
  -- 证明过程
end
```

### 算法实现1

```rust
// 连续随机变量生成器
trait ContinuousRandomVariable {
    fn probability_density_function(&self, x: f64) -> f64;
    fn sample(&self) -> f64;
}

// 均匀分布
struct UniformDistribution {
    a: f64,
    b: f64,
}

impl ContinuousRandomVariable for UniformDistribution {
    fn probability_density_function(&self, x: f64) -> f64 {
        if x >= self.a && x <= self.b {
            1.0 / (self.b - self.a)
        } else {
            0.0
        }
    }
    
    fn sample(&self) -> f64 {
        self.a + (self.b - self.a) * rand::random::<f64>()
    }
}

// 正态分布（Box-Muller变换）
struct NormalDistribution {
    mu: f64,
    sigma: f64,
}

impl ContinuousRandomVariable for NormalDistribution {
    fn probability_density_function(&self, x: f64) -> f64 {
        let z = (x - self.mu) / self.sigma;
        (1.0 / (self.sigma * (2.0 * std::f64::consts::PI).sqrt())) *
        (-0.5 * z * z).exp()
    }
    
    fn sample(&self) -> f64 {
        let u1 = rand::random::<f64>();
        let u2 = rand::random::<f64>();
        let z0 = (-2.0 * u1.ln()).sqrt() * (2.0 * std::f64::consts::PI * u2).cos();
        self.mu + self.sigma * z0
    }
}
```

## 随机变量的数字特征

### 期望

#### 定义2

```lean
-- 期望定义
def expectation (X : Ω → ℝ) : ℝ :=
  if discrete_random_variable X then
    ∑ᵢ xᵢ * pmf X xᵢ
  else
    ∫[ℝ] x * pdf X x
```

#### 性质2

```lean
-- 期望性质
theorem expectation_properties (X Y : Ω → ℝ) (a b : ℝ) :
  (E (a * X + b) = a * E X + b) ∧           -- 线性性
  (E (X + Y) = E X + E Y) ∧                 -- 可加性
  (X ≥ 0 → E X ≥ 0) ∧                       -- 非负性
  (|E X| ≤ E |X|) :=                         -- 绝对值不等式
begin
  -- 证明过程
end
```

### 方差

#### 定义3

```lean
-- 方差定义
def variance (X : Ω → ℝ) : ℝ :=
  E ((X - E X)^2)
```

#### 性质3

```lean
-- 方差性质
theorem variance_properties (X Y : Ω → ℝ) (a b : ℝ) :
  (V (a * X + b) = a^2 * V X) ∧             -- 线性变换
  (V (X + Y) = V X + V Y + 2 * Cov X Y) ∧  -- 加法公式
  (V X ≥ 0) ∧                               -- 非负性
  (V X = E (X^2) - (E X)^2) :=              -- 计算公式
begin
  -- 证明过程
end
```

### 协方差

#### 定义4

```lean
-- 协方差定义
def covariance (X Y : Ω → ℝ) : ℝ :=
  E ((X - E X) * (Y - E Y))
```

#### 性质4

```lean
-- 协方差性质
theorem covariance_properties (X Y Z : Ω → ℝ) (a b : ℝ) :
  (Cov X Y = Cov Y X) ∧                     -- 对称性
  (Cov (a * X + b) Y = a * Cov X Y) ∧      -- 线性性
  (Cov (X + Y) Z = Cov X Z + Cov Y Z) ∧    -- 可加性
  (|Cov X Y| ≤ sqrt (V X * V Y)) :=         -- 柯西不等式
begin
  -- 证明过程
end
```

## 大数定律与中心极限定理

### 大数定律

```lean
-- 弱大数定律
theorem weak_law_of_large_numbers (X₁ X₂ ... : Ω → ℝ) :
  (∀ i, E Xᵢ = μ ∧ V Xᵢ = σ²) →
  ∀ ε > 0, lim P (|X̄ₙ - μ| ≥ ε) = 0 :=
begin
  intros h1 ε hε,
  -- 证明过程
end
```

### 中心极限定理

```lean
-- 中心极限定理
theorem central_limit_theorem (X₁ X₂ ... : Ω → ℝ) :
  (∀ i, E Xᵢ = μ ∧ V Xᵢ = σ²) →
  (X̄ₙ - μ) / (σ / sqrt n) → N(0, 1) :=
begin
  intros h,
  -- 证明过程
end
```

## 应用领域

### 统计学

```lean
-- 参数估计
def maximum_likelihood_estimation (X : Ω → ℝ) (θ : ℝ) : ℝ :=
  argmax θ (likelihood X θ)

-- 假设检验
def hypothesis_test (H₀ : Prop) (α : ℝ) : Prop :=
  P (reject H₀ | H₀ true) ≤ α
```

### 机器学习

```rust
// 概率模型
struct GaussianMixtureModel {
    components: Vec<NormalDistribution>,
    weights: Vec<f64>,
}

impl GaussianMixtureModel {
    fn probability_density_function(&self, x: f64) -> f64 {
        self.components.iter()
            .zip(self.weights.iter())
            .map(|(component, weight)| {
                weight * component.probability_density_function(x)
            })
            .sum()
    }
    
    fn expectation_maximization(&mut self, data: &[f64]) {
        // EM算法实现
        for _ in 0..100 {
            // E步：计算后验概率
            let posteriors = self.compute_posteriors(data);
            
            // M步：更新参数
            self.update_parameters(data, &posteriors);
        }
    }
}
```

### 金融学

```lean
-- 期权定价
def black_scholes_model (S₀ K T r σ : ℝ) : ℝ :=
  S₀ * normal_cdf d₁ - K * exp (-r * T) * normal_cdf d₂
  where
    d₁ := (ln (S₀ / K) + (r + σ² / 2) * T) / (σ * sqrt T)
    d₂ := d₁ - σ * sqrt T

-- 风险价值
def value_at_risk (X : Ω → ℝ) (α : ℝ) : ℝ :=
  quantile X (1 - α)
```

## 学习路径

### 基础阶段

1. **理解随机变量概念**
2. **掌握离散分布**
3. **学习连续分布**

### 进阶阶段

1. **数字特征计算**
2. **大数定律理解**
3. **中心极限定理**

### 应用阶段

1. **统计学应用**
2. **机器学习应用**
3. **金融学应用**

## 教学策略

### 多表征学习

- **符号表征**：数学公式和符号
- **图形表征**：分布函数图像
- **数值表征**：数值计算和模拟
- **物理表征**：实际应用和模型

### 认知负荷管理

- **分步教学**：从简单到复杂
- **渐进复杂**：逐步增加难度
- **多角度验证**：多种方法验证

### 错误预防

- **常见错误**：
  - 混淆离散和连续分布
  - 期望和方差计算错误
  - 分布参数理解错误
- **预防策略**：
  - 强调概念理解
  - 多练习
  - 系统化检查

## 评估标准

### 理解层面

- 能否解释随机变量概念
- 能否理解分布函数
- 能否识别分布类型

### 应用层面

- 能否正确计算期望方差
- 能否应用分布理论
- 能否解决实际问题

### 创新层面

- 能否发现新的应用
- 能否优化计算方法
- 能否建立新的联系

## 扩展阅读

### 理论扩展

- **多元随机变量**：联合分布、边缘分布
- **随机过程**：时间序列的概率理论
- **极值理论**：极值分布理论

### 应用扩展

- **统计推断**：参数估计、假设检验
- **机器学习**：概率模型、贝叶斯网络
- **金融数学**：风险模型、期权定价

### 历史文献

- 拉普拉斯《概率论》
- 高斯《误差理论》
- 柯尔莫哥洛夫《概率论基础》

---

*随机变量与分布是概率论的核心，为统计学、机器学习、金融学等领域提供了强大的数学工具。*

## 典型例题与详细解答

### 例题1：离散型随机变量

**题目**：抛掷两枚骰子，X表示点数和，求X的所有可能取值及其概率分布。
**解答**：
X取值2~12，各概率分别为：
P(2)=1/36，P(3)=2/36，P(4)=3/36，...，P(7)=6/36，...，P(12)=1/36。

### 例题2：概率分布与期望

**题目**：某随机变量X的概率分布为P(X=1)=0.3, P(X=2)=0.7，求E(X)。
**解答**：
E(X)=1×0.3+2×0.7=1.7。

### 例题3：二项分布

**题目**：抛掷3枚硬币，求恰有2次正面的概率。
**解答**：
C(3,2)×(1/2)²×(1/2)=3×1/4×1/2=3/8。

### 例题4：连续型随机变量

**题目**：设X在[0,1]上均匀分布，求P(X>0.6)。
**解答**：
P(X>0.6)=1-0.6=0.4。

### 例题5：方差计算

**题目**：某随机变量X的概率分布为P(X=1)=0.5, P(X=3)=0.5，求方差D(X)。
**解答**：
E(X)=1×0.5+3×0.5=2
E(X²)=1²×0.5+3²×0.5=0.5+4.5=5
D(X)=E(X²)-[E(X)]²=5-4=1

---

> 以上例题覆盖随机变量与分布核心知识点，配有详细解答，便于学习者理解与创新训练。
